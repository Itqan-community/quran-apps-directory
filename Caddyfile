{
	# Security headers.
	header X-Frame-Options "SAMEORIGIN"
	header X-Content-Type-Options "nosniff"
	header X-XSS-Protection "1; mode=block"
	header Referrer-Policy "strict-origin-when-cross-origin"
	# CSP is configured via meta tag in index.html to avoid Railway edge sanitization
	# Railway's edge proxy strips 'unsafe-eval' and blob: from HTTP headers
	# The meta tag in HTML provides the complete CSP policy for Angular

	# Enable gzip compression
	encode gzip zstd

	# Handle static assets
	@static {
		path *.js *.css *.png *.jpg *.jpeg *.gif *.ico *.svg *.woff *.woff2 *.ttf *.eot *.avif *.webp *.webmanifest
	}
	header @static Cache-Control "public, max-age=31536000, immutable"

	# Service Worker
	@sw path /sw.js
	header @sw Cache-Control "no-cache"

	# Health check
	@health path /health
	respond @health 200 "healthy\n"

	# Handle client-side routing (fallback to index.html)
	try_files {path} /index.html
}

# Handle different environments
:{$PORT:3000} {
	root * /usr/share/nginx/html
	file_server
}