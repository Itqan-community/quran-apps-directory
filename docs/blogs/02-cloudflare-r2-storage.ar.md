# ูุดุฑ ุชุฎุฒูู ุตูุฑ Cloudflare R2 ูุน Django: ุฏููู ุงูุฅุนุฏุงุฏ ุงููุงูู

ุชุฎุฒูู ุงูุตูุฑ ุงูุชู ูุฑูุนูุง ุงููุณุชุฎุฏููู ูุชูุฏูููุง ุจููุงุกุฉ ูู ุชุญุฏ ุชูุงุฌูู ูู ุชุทุจูู ูุงู. ุงูุชุฎุฒูู ุงูุชูููุฏู ูู ุงููุธุงู ุงููููู ูุง ูุชูุณุน ุจุดูู ุฌูุฏุ ูุดุจูุงุช ุงูุชุณููู ูุญุชูุงู ููููุฉุ ูุฅุฏุงุฑุฉ ุงูุจููุฉ ุงูุชุญุชูุฉ ุชุตุจุญ ูุนูุฏุฉ.

**Cloudflare R2** ูุญู ูุฐู ุงููุดููุฉ ุจุฃูุงูุฉ. ุฅูู ุชุฎุฒูู ูุงุฆูุงุช ูุชูุงูู ูุน S3 ูุน ุชุณููู CDN ูุฏูุฌ ู**ุจุฏูู ุฑุณูู ุฎุฑูุฌ**โุชุบููุฑ ุงููุนุจุฉ ูููุดุงุฑูุน ุงูุชู ุชุฑุงูุจ ุงูููุฒุงููุฉ.

ูู ูุฐุง ุงูููุดูุฑุ ุณูุดุฑุญ ููููุฉ ุฏูุฌูุง Cloudflare R2 ูุน Django ูู ุฏููู ุชุทุจููุงุช ุงููุฑุขูุ ูุนุงูุฌุฉ ุตูุฑ ุงูุฅุฑุณุงูุงุช ูุงูุชุญุณููุงุช ูุงูุฏุฑูุณ ุงูุชู ุชุนูููุงูุง.

---

## ููุงุฐุง Cloudflare R2ุ

### ุงููุดููุฉ ูุน ุงูุชุฎุฒูู ุงูุชูููุฏู

ุนูุฏ ุจูุงุก ูุธุงู ุฅุฑุณุงู ุชุทุจููุงุช ุฏููู ุชุทุจููุงุช ุงููุฑุขูุ ุงุญุชุฌูุง ูุชุฎุฒูู:
- ุฃููููุงุช ุงูุชุทุจููุงุช
- ุตูุฑ ูุนุงููุฉ (ูุณุฎ ุฅูุฌููุฒูุฉ ูุนุฑุจูุฉ)
- ุนุฏุฉ ููุทุงุช ุดุงุดุฉ ููู ุชุทุจูู

ุงุณุชุฎุฏุงู ุชุฎุฒูู ูุธุงู ุงููููุงุช ุงููุญูู ูู ูููุฏ ุฌุฏูุฉ:

```
โ ูุง ูุชูุณุน ุนุจุฑ ุฎูุงุฏู ูุชุนุฏุฏุฉ
โ ุบูุฑ ููุงุณุจ ููุดุฑุงุช ุงูุณุญุงุจุฉ
โ ูุชุทูุจ ุงุณุชุฑุงุชูุฌูุงุช ูุณุฎ ุงุญุชูุงุทู ูุฏููุฉ
โ ูุจุทุฆ ุฎุงุฏู ุงูุชุทุจูู
โ ุตุนุจ ุงูุชุณููู ุงูุนุงููู
```

### ููุงุฐุง ุงุฎุชุฑูุง R2

```
โ API ูุชูุงููุฉ ูุน S3 (ูุนูุงุฑูุฉ ููุซุจุชุฉ)
โ ุจุฏูู ุฑุณูู ุฎุฑูุฌ (ุชูููุฑ ูุงุฆู ูู ุงูุชูุงููู)
โ ุชูุงูู CDN ุชููุงุฆู
โ ุชุณุนูุฑ ุจูุงุกู ุนูู ุงูุงุณุชุฎุฏุงู
โ ุชูุซูู ููุชุงุฒ
โ ุนูููุฉ ุฅุนุฏุงุฏ ุจุณูุทุฉ
โ ุชุนูู ุจุดูู ุฑุงุฆุน ูุน Django
```

**ุงูุฎูุงุตุฉ:** R2 ูุซุงูู ูููุดุงุฑูุน ุงูุชู ุชุนุทู ุงูุฃููููุฉ ูููุงุกุฉ ุงูุชูุงููู ุฏูู ุงูุชุถุญูุฉ ุจุงูุฃุฏุงุก ุฃู ูุงุจููุฉ ุงูุชูุณุน.

---

## ูุธุฑุฉ ุนุงูุฉ ุนูู ุงูุนูุงุฑุฉ

ุฅููู ููู ููุงุณุจ R2 ุชุทุจูู Django ูุฏููุง:

```
ุงููุณุชุฎุฏู ูุฑูุน ุงูุตูุฑ
      โ
ููุธุฑ/API Django
      โ
boto3 (ุนููู S3)
      โ
Cloudflare R2
      โ
ุฑุงุจุท R2 โ ูุฎุฒู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
      โ
ุงููุณุชุฎุฏู ูุณุชุฑุฌุน ุงูุตูุฑุฉ
      โ
Cloudflare CDN โ ุชููุงุฆู
      โ
ุงูุตูุฑุฉ ุชููุฏููู ูููุณุชุฎุฏู (ุณุฑูุน!)
```

### ุงูููููุงุช ุงูุฑุฆูุณูุฉ

1. **boto3** - AWS SDK ููุจูุซูู (ูุนูู ูุน R2 ุนุจุฑ ุงูุชูุงูู ูุน S3)
2. **Cloudflare R2** - ุฎุฏูุฉ ุชุฎุฒูู ุงููุงุฆูุงุช
3. **Django Storage Backend** - ุฎูููุฉ ุชุฎุฒูู ูุฎุตุตุฉ ุฃู ุชูุงูู django-storages
4. **ูุงุนุฏุฉ ุงูุจูุงูุงุช** - ุชุฎุฒู ุฑูุงุจุท R2 ููุงุณุชุฑุฌุงุน
5. **CDN** - ุชุณููู ุณุฑูุน ุชููุงุฆู Cloudflare

---

## ุงููุชุทูุจุงุช ุงูุฃุณุงุณูุฉ

ูุจู ุงูุจุฏุกุ ุชุฃูุฏ ูู ูุฌูุฏ:

- ูุดุฑูุน Django (ุฃู ุฅุตุฏุงุฑ ุญุฏูุซ)
- Python 3.8+
- ุญุณุงุจ Cloudflare (ุงููุณุชูู ุงููุฌุงูู ูุนูู)
- ูุนุฑูุฉ ุฃุณุงุณูุฉ ุจููุงุฐุฌ Django ูุงูููุธุฑุงุช
- ุฎุจุฑุฉ AWS CLI ุฃู boto3 (ูููุฏุฉ ููู ููุณุช ุถุฑูุฑูุฉ)

---

## ุงูุฎุทูุฉ 1: ุฅูุดุงุก ุฏูู ุชุฎุฒูู R2

### 1.1 ุชุณุฌูู ุงูุฏุฎูู ุฅูู ููุญุฉ ูุนูููุงุช Cloudflare

ุงุฐูุจ ุฅูู [dash.cloudflare.com](https://dash.cloudflare.com) ูุงูุงูุชูู ุฅูู:

```
ุตูุญุฉ ุงูุญุณุงุจ โ R2 โ ุฅูุดุงุก ุฏูู
```

### 1.2 ุฅูุดุงุก ุฏูู ุฌุฏูุฏ

```
ุงุณู ุงูุฏูู: quran-apps-submissions
(ุฃู ุฃู ุงุณู ูุทุงุจู ูุดุฑูุนู)
ุงูููุทูุฉ: ุงููุดู ุงูุชููุงุฆู (ููุตู ุจู)
ุงููุฑ: ุฅูุดุงุก ุงูุฏูู
```

**ููู:** ุชุฐูุฑ ุงุณู ุงูุฏููโุณุชุญุชุงุฌ ุฅููู ูุงุญูุงู.

### 1.3 ุฅูุดุงุก ุฑูุฒ API

ูู ุฅุนุฏุงุฏุงุช R2ุ ุงููุฑ ุนูู **ุฅูุดุงุก ุฑูุฒ API**:

```
ุงุณู ุงูุฑูุฒ: django-app
ุงูุฃุฐููุงุช: ุงููุฑุงุกุฉ ูุงููุชุงุจุฉ
TTL: ุงุฎุชุฑ ุงูุชูุงุก ุตูุงุญูุฉ ููุงุณุจ (6 ุฃุดูุฑุ ุณูุฉุ ุฃู ูุง ููุฌุฏ)
ุชูููุฏ ุจู: quran-apps-submissions
```

ุณุชุญุตู ุนูู ุซูุงุซ ูููโ**ุงุญูุธูุง ุจุฃูุงู**:
- `R2_ACCOUNT_ID`
- `R2_ACCESS_KEY_ID`
- `R2_SECRET_ACCESS_KEY`

---

## ุงูุฎุทูุฉ 2: ุชุซุจูุช ุงุนุชูุงุฏูุงุช Python

ุซุจุช boto3 ูุงูุญุฒู ุงูุฏุงุนูุฉ:

```bash
pip install boto3 botocore
```

ุฃู ุฃุถู ุฅูู `requirements.txt`:

```
boto3>=1.26.0
botocore>=1.29.0
```

---

## ุงูุฎุทูุฉ 3: ุชูููู ุฅุนุฏุงุฏุงุช Django

ุฃูุดุฆ ูุชุบูุฑุงุช ุจูุฆูุฉ ูุจูุงูุงุช ุงูุงุนุชูุงุฏ. ูู ููู `.env`:

```bash
# ุชูููู Cloudflare R2
R2_ACCOUNT_ID=your_account_id_here
R2_ACCESS_KEY_ID=your_access_key_here
R2_SECRET_ACCESS_KEY=your_secret_key_here
R2_BUCKET_NAME=quran-apps-submissions
R2_REGION=auto
```

ูู `settings.py` ุงูุฎุงุต ุจู Django:

```python
import os
from pathlib import Path

# ุชูููู Cloudflare R2
if os.getenv('R2_ACCOUNT_ID'):
    # ุชู ุชูููู R2
    AWS_ACCESS_KEY_ID = os.getenv('R2_ACCESS_KEY_ID')
    AWS_SECRET_ACCESS_KEY = os.getenv('R2_SECRET_ACCESS_KEY')

    AWS_S3_ENDPOINT_URL = (
        f"https://{os.getenv('R2_ACCOUNT_ID')}.r2.cloudflarestorage.com"
    )

    AWS_STORAGE_BUCKET_NAME = os.getenv('R2_BUCKET_NAME', 'quran-apps')
    AWS_S3_REGION_NAME = os.getenv('R2_REGION', 'auto')

    # ุชูููู ุงูุฑุงุจุท
    AWS_S3_CUSTOM_DOMAIN = f"{AWS_STORAGE_BUCKET_NAME}.{os.getenv('R2_ACCOUNT_ID')}.r2.cloudflarestorage.com"
    AWS_S3_URL_PROTOCOL = 'https'
    AWS_S3_ADDRESS_STYLE = 'virtual'

    # ุชุณููุฉ ุงููููุงุช
    AWS_S3_FILE_OVERWRITE = False
    AWS_DEFAULT_ACL = 'public-read'

    # ูููุงุช ุซุงุจุชุฉ/ูุณุงุฆุท
    DEFAULT_FILE_STORAGE = 'storages.backends.s3boto3.S3Boto3Storage'
else:
    # ุงูุฑุฌูุน ุฅูู ุงูุชุฎุฒูู ุงููุญูู ูู ุงูุชุทููุฑ
    DEFAULT_FILE_STORAGE = 'django.core.files.storage.FileSystemStorage'
    MEDIA_ROOT = os.path.join(BASE_DIR, 'media')
    MEDIA_URL = '/media/'
```

---

## ุงูุฎุทูุฉ 4: ุฅูุดุงุก ุฎุฏูุฉ ุงูุชุฎุฒูู

ุจุฏูุงู ูู ูุซุฑ ููุฏ R2 ูู ุฌููุน ุฃูุญุงุก ุงูุชุทุจููุ ุฃูุดุฆ ุฎุฏูุฉ ุชุฎุฒูู ูุฑูุฒูุฉ:

```python
# services/storage_service.py
import boto3
import os
import logging
from botocore.exceptions import ClientError

logger = logging.getLogger(__name__)


class StorageError(Exception):
    """ูุฑูุน ุนูุฏ ูุดู ุนูููุงุช ุงูุชุฎุฒูู."""
    pass


class R2StorageService:
    """ุฎุฏูุฉ ุชุฎุฒูู Cloudflare R2 ูุฑูุน ูุฅุฏุงุฑุฉ ุงููููุงุช."""

    def __init__(self):
        self.account_id = os.getenv('R2_ACCOUNT_ID')
        self.access_key = os.getenv('R2_ACCESS_KEY_ID')
        self.secret_key = os.getenv('R2_SECRET_ACCESS_KEY')
        self.bucket = os.getenv('R2_BUCKET_NAME')
        self.endpoint = (
            f"https://{self.account_id}.r2.cloudflarestorage.com"
        )

    def is_configured(self) -> bool:
        """ุชุญูู ููุง ุฅุฐุง ุชู ุชูููู R2 ุจุดูู ุตุญูุญ."""
        return all([
            self.account_id,
            self.access_key,
            self.secret_key,
            self.bucket
        ])

    def _get_client(self):
        """ุฅูุดุงุก ูุฅุนุงุฏุฉ ุนููู boto3 S3."""
        return boto3.client(
            's3',
            endpoint_url=self.endpoint,
            aws_access_key_id=self.access_key,
            aws_secret_access_key=self.secret_key,
            region_name='auto'
        )

    def upload_from_url(self, url: str, prefix: str) -> str:
        """
        ุชุญููู ุงูููู ูู ุฑุงุจุท ูุฑูุนู ุฅูู R2.

        Args:
            url: ุฑุงุจุท ุงููุตุฏุฑ
            prefix: ุจุงุฏุฆุฉ ูุณุงุฑ ุงูุชุฎุฒูู

        Returns:
            ุฑุงุจุท R2 ุงูุนุงู ููููู ุงููุฑููุน

        Raises:
            StorageError: ุฅุฐุง ูุดู ุงูุฑูุน
        """
        if not self.is_configured():
            raise StorageError("R2 ูู ูุชู ุชููููู")

        try:
            import requests
            response = requests.get(url, timeout=10)
            response.raise_for_status()

            filename = url.split('/')[-1]
            key = f"{prefix}/{filename}"

            client = self._get_client()
            client.put_object(
                Bucket=self.bucket,
                Key=key,
                Body=response.content,
                ACL='public-read'
            )

            return f"https://{self.bucket}.{self.account_id}.r2.cloudflarestorage.com/{key}"

        except ClientError as e:
            logger.error(f"ูุดู ุฑูุน R2: {e}")
            raise StorageError(f"ูุดู ุงูุฑูุน: {e}")
        except Exception as e:
            logger.error(f"ุฎุทุฃ ุบูุฑ ูุชููุน ุฃุซูุงุก ุงูุฑูุน: {e}")
            raise StorageError(f"ุฎุทุฃ ุงูุฑูุน: {e}")


def get_storage_service() -> R2StorageService:
    """ุฏุงูุฉ ุงููุตูุน ููุญุตูู ุนูู ุฎุฏูุฉ ุงูุชุฎุฒูู."""
    return R2StorageService()
```

### ุงูุงุณุชุฎุฏุงู

```python
from services.storage_service import get_storage_service, StorageError

def upload_app_icon(app_icon_url: str) -> str:
    """ุฑูุน ุฃููููุฉ ุงูุชุทุจูู ุฅูู R2."""
    storage = get_storage_service()

    if not storage.is_configured():
        raise ValueError("ุชุฎุฒูู R2 ูู ูุชู ุชููููู")

    try:
        r2_url = storage.upload_from_url(
            url=app_icon_url,
            prefix='icons'
        )
        return r2_url
    except StorageError as e:
        logger.error(f"ูุดู ุงูุฑูุน: {e}")
        raise
```

---

## ุงูุฎุทูุฉ 5: ุงูุชูุงูู ูุน ููุงุฐุฌ Django

ุงุฎุฒู ุฑูุงุจุท R2 ูู ุงูููุงุฐุฌ:

```python
from django.db import models

class AppSubmission(models.Model):
    # ... ุญููู ุฃุฎุฑู ...

    # ุงุฎุฒู ุฑูุงุจุท R2 ูุจุงุดุฑุฉ (ููุณ ุญููู ูููุงุช)
    app_icon_url = models.URLField(
        blank=True,
        help_text="ุฑุงุจุท ุฃููููุฉ ุงูุชุทุจูู (ูุณุชุถุงู ุนูู R2)"
    )
    main_image_en = models.URLField(
        blank=True,
        help_text="ุฑุงุจุท ุงูุตูุฑุฉ ุงูุฑุฆูุณูุฉ ุงูุฅูุฌููุฒูุฉ (ูุณุชุถุงู ุนูู R2)"
    )
    main_image_ar = models.URLField(
        blank=True,
        help_text="ุฑุงุจุท ุงูุตูุฑุฉ ุงูุฑุฆูุณูุฉ ุงูุนุฑุจูุฉ (ูุณุชุถุงู ุนูู R2)"
    )
    screenshots_en = models.JSONField(
        default=list,
        help_text="ูุงุฆูุฉ ุฑูุงุจุท ููุทุงุช ุงูุดุงุดุฉ ุงูุฅูุฌููุฒูุฉ (ูุณุชุถุงู ุนูู R2)"
    )
    screenshots_ar = models.JSONField(
        default=list,
        help_text="ูุงุฆูุฉ ุฑูุงุจุท ููุทุงุช ุงูุดุงุดุฉ ุงูุนุฑุจูุฉ (ูุณุชุถุงู ุนูู R2)"
    )
```

---

## ุงูุฎุทูุฉ 6: ุงูุงุฎุชุจุงุฑ ูุญููุงู

### ุจุฏูู R2 (ููุตู ุจู ููุชุทููุฑ)

ููุชุทููุฑ ุงููุญููุ ุงูุฑุฌูุน ุฅูู ุชุฎุฒูู ูุธุงู ุงููููุงุช:

```bash
# ูุง ุชุนููู ูุชุบูุฑุงุช ุจูุฆุฉ R2 ูุญููุงู
# ุณูุณุชุฎุฏู Django MEDIA_ROOT/MEDIA_URL ุจุฏูุงู ูู ุฐูู
```

### ูุน R2 (ุงุฎุชูุงุฑู)

ูุงุฎุชุจุงุฑ R2 ูุญููุงูุ ุฃูุดุฆ `.env.local`:

```
R2_ACCOUNT_ID=your_test_account_id
R2_ACCESS_KEY_ID=your_test_key
R2_SECRET_ACCESS_KEY=your_test_secret
R2_BUCKET_NAME=test-bucket
```

ุซู ุงุฎุชุจุฑ ุงูุฑูุน:

```python
from django.test import TestCase
from services.storage_service import get_storage_service

class R2StorageTests(TestCase):
    def test_upload(self):
        storage = get_storage_service()

        # ุงุฎุชุจุฑ ุจุฑุงุจุท ุญูููู
        url = storage.upload_from_url(
            url='https://example.com/test.jpg',
            prefix='tests'
        )

        self.assertIn('r2.cloudflarestorage.com', url)
        self.assertTrue(url.startswith('https://'))
```

---

## ุงูุฎุทูุฉ 7: ุชุญุณููุงุช ุงูุฃุฏุงุก

### 1. ุชุญุณูู ุงูุตูุฑ ูุจู ุงูุฑูุน

```python
from PIL import Image
from io import BytesIO
import requests

def optimize_and_upload(url: str, max_size: tuple = (2000, 2000)) -> str:
    """ุชุญููู ูุชุญุณูู ูุฑูุน ุงูุตูุฑุฉ."""

    # ุชุญููู
    response = requests.get(url)
    img = Image.open(BytesIO(response.content))

    # ุชุบููุฑ ุงูุญุฌู ุฅุฐุง ูุฒู ุงูุฃูุฑ
    if img.size[0] > max_size[0] or img.size[1] > max_size[1]:
        img.thumbnail(max_size, Image.Resampling.LANCZOS)

    # ุชุญููู ุฅูู WebP (ุฃูุซุฑ ููุงุกุฉ)
    buffer = BytesIO()
    img.save(buffer, format='WEBP', quality=85, optimize=True)
    buffer.seek(0)

    # ุฑูุน
    client = get_storage_service()._get_client()
    key = f"images/{url.split('/')[-1]}.webp"

    client.put_object(
        Bucket=os.getenv('R2_BUCKET_NAME'),
        Key=key,
        Body=buffer.getvalue(),
        ContentType='image/webp',
        ACL='public-read'
    )

    account_id = os.getenv('R2_ACCOUNT_ID')
    bucket = os.getenv('R2_BUCKET_NAME')
    return f"https://{bucket}.{account_id}.r2.cloudflarestorage.com/{key}"
```

### 2. ุฑุคูุณ ุงูุชุฎุฒูู ุงููุคูุช ููู CDN

ูููู R2 ููุชูุฏูู ุจุฑุคูุณ ุงูุชุฎุฒูู ุงููุคูุช ุงูููุงุณุจุฉ:

```python
# ูู ุฎุฏูุฉ ุงูุชุฎุฒูู
client.put_object(
    Bucket=self.bucket,
    Key=key,
    Body=response.content,
    ACL='public-read',
    CacheControl='public, max-age=31536000, immutable'  # ุณูุฉ ูุงุญุฏุฉ
)
```

### 3. ุงุณุชุฎุฏู CDN ุงูุฎุงุต ุจู Cloudflare

R2 ูุชูุงูู ุจุณูุงุณุฉ ูุน CDN ุงูุฎุงุต ุจู Cloudflare:

1. ุฃุถู ูุทุงู R2 ุฅูู ููุทูุชู ูู Cloudflare
2. ุนููู ููุงุนุฏ ุงูุชุฎุฒูู ุงููุคูุช ููุชุฎุฒูู ุงูุนุฏูุงูู
3. ูุชู ุชุฎุฒูู ุงูุตูุฑ ุชููุงุฆูุงู ุจุดูู ุนุงู

---

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ุฃุฎุทุงุก "ุงููุตูู ูุฑููุถ"

**ุงูุณุจุจ:** ุจูุงูุงุช ุงุนุชูุงุฏ ุบูุฑ ุตุญูุญุฉ ุฃู ุฃุฐููุงุช
**ุงูุญู:**
```bash
# ุชุญูู ูู ุจูุงูุงุช ุงูุงุนุชูุงุฏ ูู .env
# ุชุญูู ูู ุฃุฐููุงุช ุฑูุฒ API ูู ููุญุฉ ูุนูููุงุช R2
# ุชุฃูุฏ ูู ุชุทุงุจู ุงุณู ุงูุฏูู ูุน ุงูุชูููู
```

### ุงููุดููุฉ: ุงูุตูุฑ ูุง ุชุญููู

**ุงูุณุจุจ:** ุงุณู ุฏูู ุฎุงุทุฆ ุฃู ูุนุฑูู ุญุณุงุจ
**ุงูุญู:**
```python
# ุงุฎุชุจุฑ ุงูุงุชุตุงู
from services.storage_service import get_storage_service

service = get_storage_service()
print(service.is_configured())  # ูุฌุจ ุฃู ูููู True
print(service.endpoint)  # ูุฌุจ ุฃู ูุทุงุจู ููุทุฉ ููุงูุฉ R2
```

### ุงููุดููุฉ: ุณุฑุนุฉ ุฑูุน ุจุทูุฆุฉ

**ุงูุณุจุจ:** ูุดุงูู ูู ุงูุดุจูุฉ ุฃู ูููุงุช ูุจูุฑุฉ
**ุงูุญู:**
- ุญุณูู ุงูุตูุฑ ูุจู ุงูุฑูุน
- ุงุณุชุฎุฏู ุงูุฑูุน ุงูููุณู ูููููุงุช ุงููุจูุฑุฉ
- ุชุญูู ูู ุงุชุตุงู ุงูุดุจูุฉ

### ุงููุดููุฉ: ุงูุชูููุฉ ุฃุนูู ูู ุงููุชููุน

**ุงูุณุจุจ:** ุฑุณูู ุงูุฎุฑูุฌ ูู ูุฒูุฏู ุขุฎุฑูู ุฃู ุนูููุงุช
**ุงูุญู:**
- R2 ุจุฏูู ุฑุณูู ุฎุฑูุฌ (ููุฒุฉ!)
- ุฑุงูุจ ุชูุงููู ุงุณุชุฏุนุงุก API
- ุงุญุฐู ุงูุตูุฑ ุบูุฑ ุงููุณุชุฎุฏูุฉ ุจุงูุชุธุงู

---

## ุชูุฏูุฑ ุงูุชูููุฉ

ูุฏููู ุชุทุจููุงุช ูููุฐุฌู ุจู 1000 ุชุทุจูู:

| ุงูุนูุตุฑ | ุงูุชูููุฉ ุงูุดูุฑูุฉ |
|------|-------------|
| ุงูุชุฎุฒูู (1TB) | ~$15 |
| ุงุณุชุฏุนุงุกุงุช API (100K) | ~$0.50 |
| ุงูุฎุฑูุฌ (R2โCDN) | $0 (ุจุฏูู ุฑุณูู ุฎุฑูุฌ!) |
| **ุงูุฅุฌูุงูู** | **~$15.50** |

ูุงุฑู ูุฐุง ูุน AWS S3:
- ุงูุชุฎุฒูู: $23
- ุงูุฎุฑูุฌ: $92 (ูููุณ ุงูุงุณุชุฎุฏุงู)
- **ุงูุฅุฌูุงูู: $115** โ 7 ูุฑุงุช ุฃูุซุฑ ุชูููุฉ!

---

## ูุงุฆูุฉ ุงูุชุญูู ูู ุงูุฅูุชุงุฌ

ูุจู ุงููุดุฑ ูู ุงูุฅูุชุงุฌ:

- [ ] ุฃูุดุฆ ุฑูุฒ API ูุฎุตุต R2 (ููุณ ุญุณุงุจู ุงูุฑุฆูุณู)
- [ ] ุงุถุจุท TTL ููุงุณุจ ุนูู ุฑูุฒ API
- [ ] ูููู ุงุณุชุฑุงุชูุฌูุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู/ุงูุงุณุชุฑุฌุงุน
- [ ] ุงุฎุชุจุฑ ุฌููุน ุณููุงุฑูููุงุช ุงูุฑูุน
- [ ] ุชุญูู ูู ุนูู ุชุฎุฒูู CDN ุงููุคูุช
- [ ] ุฃุนุฏู ุงููุฑุงูุจุฉ/ุงูุชูุจููุงุช
- [ ] ูุซูู ุฅุฌุฑุงุกุงุช ุงูุงุณุชุฑุฌุงุน
- [ ] ุฑุงุฌุน ุฃุฐููุงุช ุงูุฏูู
- [ ] ุงุฎุชุจุฑ ุณููุงุฑูููุงุช ุงููุดู

---

## ุฃูุถู ุงูููุงุฑุณุงุช

### 1. ุงุณุชุฎุฏู ุจุงุฏุฆุงุช ุฐุงุช ูุนูู
```python
# ุฌูุฏ
key = f"submissions/{submission_id}/icons/{filename}"

# ุณูุก
key = filename
```

### 2. ุชุญูู ูุจู ุงูุฑูุน
```python
# ุชุญูู ูู ุญุฌู ุงูููู
if len(response.content) > 10 * 1024 * 1024:  # 10MB
    raise StorageError("ุงูููู ูุจูุฑ ุฌุฏุงู")

# ุชุญูู ูู ููุน ุงููุญุชูู
if not response.headers.get('content-type', '').startswith('image'):
    raise StorageError("ููุน ููู ุบูุฑ ุตุญูุญ")
```

### 3. ุชุนุงูู ูุน ุงูุฃุฎุทุงุก ุจูุทู
```python
try:
    r2_url = storage.upload_from_url(url)
except StorageError:
    # ุงูุฑุฌูุน ุฅูู ุงูุฑุงุจุท ุงูุฃุตูู ุฅุฐุง ูุดู R2
    return url
```

### 4. ุฑุงูุจ ุงูุงุณุชุฎุฏุงู
```bash
# ุงุนุฑุถ ุฅุญุตุงุฆูุงุช ุงูุฏูู
# ูู ููุญุฉ ูุนูููุงุช Cloudflare โ R2 โ ุงูุฏูู โ ุงูุฅุญุตุงุฆูุงุช
# ุฑุงูุจ ุญุฌู ุงูุชุฎุฒูู
# ุชุชุจุน ุนุฏุฏ ุงุณุชุฏุนุงุกุงุช API
# ุฑุงุฌุน ุงุณุชุฎุฏุงู ุงููุทุงู ุงูุชุฑุฏุฏู
```

---

## ูุง ุชุนูููุงู

### โ ูุง ุนูู ุจุดูู ุฌูุฏ
- ุชูุงูู R2 ูุน S3 ุฌุนู ุงูุชูุงูู ูุจุงุดุฑุงู
- ุนุฏู ูุฌูุฏ ุฑุณูู ุฎุฑูุฌ ูููุฑ ุชูููุฑุงู ูุงุฆูุงู ูู ุงูุชูุงููู
- ุชูุงูู CDN ุงูุชููุงุฆู ุญุณูู ุงูุฃุฏุงุก
- Boto3 ูุงุถุฌ ูููุซูู
- ุงูุชูููู ุงููุงุฆู ุนูู ุงูุจูุฆุฉ ุฃุจูู ุงูุฃุณุฑุงุฑ ุขููุฉ

### โ๏ธ ูุง ูุงู ูุนูุฏุงู
- ุชูููู ุฃุฐููุงุช ุฑูุฒ API ุงูุฃููู
- ููู ุชูุณูู ุฑุงุจุท ููุทุฉ ููุงูุฉ R2
- ุงูุชุนุงูู ูุน ุงููุทุงุนุงุช ุงููููุฉ ุงูุฒูููุฉ ุฃุซูุงุก ุฑูุน ุงููููุงุช ุงููุจูุฑุฉ
- ุชุญุณูู ุงูุตูุฑ ูุจู ุงูุชุฎุฒูู
- ุชุตุญูุญ ุฃุฎุทุงุก API S3 (ุบุงูุจุงู ุบุงูุถุฉ)

### ๐ก ุงูุชูุตูุงุช ุงูุฑุฆูุณูุฉ
1. ุงุณุชุฎุฏู ูุฆุฉ ุฎุฏูุฉ ูุฎุตุตุฉ (ูุง ุชูุซุฑ ููุฏ S3 ุญูู)
2. ูููุฐ ุชุญุณูู ุงูุตูุฑ ูุจู ุงูุฑูุน
3. ุงุฎุฒู ุฑูุงุจุท R2 ูู ูุงุนุฏุฉ ุงูุจูุงูุงุชุ ูููุณ ุญููู ุงููููุงุช
4. ุงุฎุชุจุฑ ุจุฑุณุงุฆู ุญููููุฉ ูู ุงููุฑุญูุฉ
5. ุฑุงูุจ ุงูุชูุงููู ุจุนูุงูุฉ ูู ุงูุดูุฑ ุงูุฃูู

---

## ุงูุฎุทูุงุช ุงูุชุงููุฉ

ุงูุขู ุจุนุฏ ุฏูุฌ R2:

1. **ูููุฐ ุดุฑูุท ุชูุฏู ุงูุฑูุน** - ุงุนุฑุถ ูููุณุชุฎุฏููู ุชูุฏู ุงูุฑูุน
2. **ุฃุถู ุชุฎุฒูู ุงูุตูุฑ ูุคูุชุงู** - ุงุญูุธ ุงูุตูุฑ ูุญููุงู ููุฃุฏุงุก
3. **ุฃุนุฏู ูุฑุงูุจุฉ** - ุฃุทูู ุชูุจููุงุช ุนูู ูุดู ุงูุฑูุน
4. **ูุนูู ุงูุฅุตุฏุงุฑุงุช** - R2 ููููู ุฅุตุฏุงุฑ ุงููุงุฆูุงุช ููุณูุงูุฉ
5. **ูููุฐ ุงูุชูุธูู** - ุงุญุฐู ุงูุตูุฑ ุงููุฏููุฉ/ุบูุฑ ุงููุณุชุฎุฏูุฉ ุชููุงุฆูุงู

---

## ุงูููุงุฑุฏ

- **ุชูุซูู Cloudflare R2:** https://developers.cloudflare.com/r2/
- **ุชูุซูู Boto3:** https://boto3.amazonaws.com/v1/documentation/api/latest/index.html
- **ุฎูููุฉ ุชุฎุฒูู Django:** https://docs.djangoproject.com/en/stable/topics/files/
- **ูุฑุฌุน S3 API:** https://docs.aws.amazon.com/AmazonS3/latest/API/

---

## ุฃุณุฆูุฉุ

ูู ูุฏูู ูุดุงูู ุฃู ุฃุณุฆูุฉ ุญูู ุชูุงูู R2ุ

- **ุงูุชุญ ูุดููุฉ:** https://github.com/Itqan-community/quran-apps-directory/issues
- **ููุชุฏู ุงููุฌุชูุน:** https://community.itqan.dev
- **ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:** connect@itqan.dev

---

**ุงูุฅุตุฏุงุฑ:** 1.0
**ุขุฎุฑ ุชุญุฏูุซ:** 30 ููููุจุฑ 2025
**ุฅุตุฏุงุฑ Django:** 5.0+
**ุฅุตุฏุงุฑ Python:** 3.8+
